/*!
 * mt3d-plugin-plateau v0.1.0
 * https://minitokyo3d.com
 * (c) 2022-2023 Akihiko Kusanagi
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).mt3dPlateau=e()}(this,(function(){"use strict";const t=["13101_chiyoda-ku/low_resolution","13102_chuo-ku/low_resolution","13103_minato-ku/low_resolution","13104_shinjuku-ku/low_resolution","13109_shinagawa-ku/low_resolution","13113_shibuya-ku/low_resolution","13116_toshima-ku/low_resolution"];class e{constructor(t){const e=this;e.id="plateau",e.name={en:"PLATEAU",fr:"PLATEAU",ja:"PLATEAU",ko:"PLATEAU",ne:"PLATEAU",pt:"PLATEAU",th:"PLATEAU","zh-Hans":"PLATEAU","zh-Hant":"PLATEAU"},e.iconStyle={backgroundSize:"32px",backgroundImage:"url(\"data:image/svg+xml,%3csvg width='40' height='40' fill='white' version='1.1' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='m19.59 16.06-13.5-7.793v15.59l27.82 16.06v-15.59l-5.565-3.213-5.565-3.213z'/%3e%3cpath d='m19.59 0-13.09 7.555 13.09 7.555z'/%3e%3cpath d='m26.75 19.24v-7.793l6.749-3.897-13.08-7.555v15.59l2.534 1.463z'/%3e%3cpath d='m33.91 23.38v-15.11l-6.336 3.658v7.794l1.267 0.7315z'/%3e%3c/svg%3e\")"},e.viewModes=["ground"],e.enabled=t&&t.enabled,e._tick=e._tick.bind(e)}onAdd(t){this.map=t}onRemove(e){e.removeLayer("plateau-ortho");for(const o of t)e.removeLayer(`tile-3d-${o}`);e.map.removeSource("plateau-ortho")}onEnabled(){const{map:e}=this;if(e.setLayerVisibility("building-3d","none"),!e.map.getLayer("plateau-ortho")){e.map.addSource("plateau-ortho",{type:"raster",tiles:["https://gic-plateau.s3.ap-northeast-1.amazonaws.com/2020/ortho/tiles/{z}/{x}/{y}.png"],maxzoom:19,minzoom:10,attribution:'<a href="https://www.mlit.go.jp/plateau/">国土交通省Project PLATEAU</a>'}),e.addLayer({id:"plateau-ortho",type:"raster",source:"plateau-ortho"},"stations-marked-13");for(const o of t)e.addLayer({id:`tile-3d-${o}`,type:"tile-3d",data:`https://plateau.geospatial.jp/main/data/3d-tiles/bldg/13100_tokyo/${o}/tileset.json`,opacity:.8,onTileLoad:t=>{const{content:e}=t,o=e.batchTableJson,a=o._gml_id.length,i=new DataView(e.batchTableBinary.buffer,o._zmin.byteOffset,8*a),s=[];for(let t=0;t<a;t++)s.push(i.getFloat64(8*t,!0));s.sort(((t,e)=>t-e)),e.cartographicOrigin.z-=36.6641+s[Math.floor(a/2)]}});this._tick()}}_tick(){const t=this,{map:e,lastRefresh:o,_tick:a}=t,i=e.clock.getTime();if(e.map.getLayer("plateau-ortho")){if(Math.floor(i/6e4)!==Math.floor(o/6e4)){const{r:o,g:a,b:s}=e.getLightColor();e.map.setPaintProperty("plateau-ortho","raster-brightness-max",.2126*o+.7152*a+.0722*s),t.lastRefresh=i}requestAnimationFrame(a)}}onDisabled(){this.map.setLayerVisibility("building-3d","visible")}onVisibilityChanged(e){const{map:o}=this;if(o.map.getLayer("plateau-ortho")){o.setLayerVisibility("plateau-ortho",e?"visible":"none");for(const a of t)o.setLayerVisibility(`tile-3d-${a}`,e?"visible":"none")}}}return function(t){return new e(t)}}));
//# sourceMappingURL=mt3d-plugin-plateau.min.js.map
